<!DOCTYPE html>
<html>
<head>
<title>Microchip TCP/IP Stack for VKmodule Ethernet boards</title>
<script src="mchp.js" type="text/javascript"></script>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> 
</head>

<body>


<h1>Мониторинг и управление</h1>

<div id="status">
	<div id="loading" style="display:none">Связь с модулем "Socket-4" отсутствует.</div>
	<div id="display">
		<span style="float:right;font-size:9px;font-weight:normal;padding-top:8px;text-indent:0px">Щелкните мышью для переключения</span>
		<br />
		<table style="width:400px" class="table">
		<tr>
			<td width="250"></td>
			<td width="20" align="center"></td>
			<td align="center">Время (сек)*</td>
		</tr>
		<tr>
			<td width="250">&nbsp;&nbsp;&nbsp;&nbsp;Реле 0:</td>
			<td width="20" align="center">
				<span class="leds">
					<img src="/Button_Off.png" id="led0" onclick="newAJAXCommand('leds.cgi?led=0&timeout='+getInputValue('r0t'))" />
				</span>
			</td>
			<td align="center"><input type="text" style="width:50px" id="r0t" /></td>
		</tr>
		<tr>
			<td width="250">&nbsp;&nbsp;&nbsp;&nbsp;Реле 1:</td>
			<td width="20" align="center">
				<span class="leds">
					<img src="/Button_Off.png" id="led1" onclick="newAJAXCommand('leds.cgi?led=1&timeout='+getInputValue('r1t'))" />
				</span>
			</td>
			<td align="center"><input type="text" style="width:50px" id="r1t" /></td>
		</tr>
		<tr>
			<td width="250">&nbsp;&nbsp;&nbsp;&nbsp;Реле 2:</td>
			<td width="20" align="center">
				<span class="leds">
					<img src="/Button_Off.png" id="led2" onclick="newAJAXCommand('leds.cgi?led=2&timeout='+getInputValue('r2t'))" />
				</span>
			</td>
			<td align="center"><input type="text" style="width:50px" id="r2t" /></td>
		</tr>
		<tr>
			<td width="250">&nbsp;&nbsp;&nbsp;&nbsp;Реле 3:</td>
			<td width="20" align="center">
				<span class="leds">
					<img src="/Button_Off.png" id="led3" onclick="newAJAXCommand('leds.cgi?led=3&timeout='+getInputValue('r3t'))" />
				</span>
			</td>
			<td align="center"><input type="text" style="width:50px" id="r3t" /></td>
		</tr>
		<tr>
			<td width="250">&nbsp;&nbsp;&nbsp;&nbsp;Реле 4:</td>
			<td width="20" align="center">
				<span class="leds">
					<img src="/Button_Off.png" id="led4" onclick="newAJAXCommand('leds.cgi?led=4&timeout='+getInputValue('r4t'))" />
				</span>
			</td>
			<td align="center"><input type="text" style="width:50px" id="r4t" /></td>
		</tr>
		<tr>
			<td width="250">&nbsp;&nbsp;&nbsp;&nbsp;Реле 5:</td>
			<td width="20" align="center">
				<span class="leds">
					<img src="/Button_Off.png" id="led5" onclick="newAJAXCommand('leds.cgi?led=5&timeout='+getInputValue('r5t'))" />
				</span>
			</td>
			<td align="center"><input type="text" style="width:50px" id="r5t" /></td>
		</tr>
		<tr>
			<td width="250">&nbsp;&nbsp;&nbsp;&nbsp;Реле 6:</td>
			<td width="20" align="center">
				<span class="leds">
					<img src="/Button_Off.png" id="led6" onclick="newAJAXCommand('leds.cgi?led=6&timeout='+getInputValue('r6t'))" />
				</span>
			</td>
			<td align="center"><input type="text" style="width:50px" id="r6t" /></td>
		</tr>
		<tr>
			<td width="250">&nbsp;&nbsp;&nbsp;&nbsp;Реле 7:</td>
			<td width="20" align="center">
				<span class="leds">
					<img src="/Button_Off.png" id="led7" onclick="newAJAXCommand('leds.cgi?led=7&timeout='+getInputValue('r7t'))" />
				</span>
			</td>
			<td align="center"><input type="text" style="width:50px" id="r7t" /></td>
		</tr>
		</table>
	</div>
</div>



</div>



<script type="text/javascript">
// Parses the xmlResponse from status.xml and updates the status box
function updateStatus(xmlData) {
	// Check if a timeout occurred
	if(!xmlData)
	{
		document.getElementById('display').style.display = 'none';
		document.getElementById('loading').style.display = 'inline';
		return;
	}

	// Make sure we're displaying the status display
	document.getElementById('loading').style.display = 'none';
	document.getElementById('display').style.display = 'inline';
	
	//Loop over all the LEDs
	for(i = 0; i < 8; i++) {
		if(getXMLValue(xmlData, 'led'+i) == '1'){
			document.getElementById('led' + i).src = "/Button_On.png";
		} else {
			document.getElementById('led' + i).src = "/Button_Off.png";
		}
	}
}
setTimeout("newAJAXCommand('/status.xml', updateStatus, true)", 300);
</script>

<script>
function getInputValue(elementId){
	var value = parseInt(document.getElementById(elementId).value);
	
	if(value == null || value == ''){
		console.log(elementId + ' value = 0');
		return 0;
	}
	
	if(isNaN(value)){
		console.log(elementId + ' value = 0');
		return 0;
	}
	
	if(value > 255 || value < 0){
		console.log(elementId + ' value = 0');
		return 0;
	}
	
	console.log(elementId + ' value = ' + value);
	return value;
}
</script>


</body>
</html>
